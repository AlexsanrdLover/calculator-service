 # Calculator Service

Микросервис для вычисления арифметических операций с поддержкой HTTP и gRPC API.

## **Описание**
- Работа выполнена на Go 1.24
- Поднимается при помощи Docker (по желанию)
- Реализованы такие операции, как +, -, *, /, ^ и корень V (подробнее можно посмотреть в документации сваггера)
- В проекте реализованы мьютексы для стабильной работы переменных

## **Запуск**
### 1. Локально
```bash
go run cmd/server/main.go
```
В корне проекта создаться файл main.exe. откройте его, чтобы программа запустилась.

### 2. В Docker
```bash
docker-compose up --build
```

## **API Endpoints**
### HTTP
- `POST /calculate` — обработка инструкций (см. пример ниже)
- `GET /swagger/` — Swagger UI
- `GET /docs/swagger.json` — Swagger спецификация

### gRPC
- Порт: `50051`
- Сервис: `Calculator.Calculate`

## **Пример запроса**
```json
[
  { "type": "calc", "op": "+", "var": "x", "left": 1, "right": 2 },
  { "type": "print", "var": "x" }
]
```

## **Пример ответа**
```json
{
  "items": [
    { "var": "x", "value": 3 }
  ]
}
```

## **Быстрый старт**
Запустите соберите нужны вам билд, запустите его. Перейдите по ссылке созданного сваггера (ссылку можно увидеть в консоле).
```bash
# Создаем локальный билд
go build cmd/server/main.go

# Запускаем сервис
main.exe
```

В отдельной консоли можно работать с запросами к сервису. Например grps-запрос (уточнение, необходимо установить утилиту grpcurl):
```bash
grpcurl -plaintext -d "{\"instructions\": [{\"type\": \"calc\", \"op\": \"+\", \"var\": \"x\", \"left_num\": 5, \"right_num\": 3}, {\"type\": \"print\", \"var\": \"x\"}]}" localhost:50051 api.Calculator/Calculate

# ответ:
{
  "items": [
    {
      "var": "x",
      "value": 8
    }
  ]
}
```

Для http-запросов удобно использовать UI сваггера.
![image](https://github.com/user-attachments/assets/1d88ded6-e4db-472f-bd3d-f56d31e1f39a)

![image](https://github.com/user-attachments/assets/1fcafb45-95c4-40bc-80a4-7c67d8a34205)

## **Тестирование**
```bash
# Все тесты
go test ./...

# С покрытием
go test -cover ./...
```

## **Соответствие требованиям**
- Покрытие тестами: >20%
- Использован паттерн: слоистая архитектура. А также -в некоторых частях программы - фабрика.
- Используемые технологии:
  - Go, gRPC, Swagger
  - Docker для развёртывания
